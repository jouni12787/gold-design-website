<!doctype html>
<html lang="en" data-theme="dark">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Checkout — Shakaroun Jewelry</title>
<link rel="icon" href="icon/icon-1024.png" type="image/png">
<style>
  :root{--radius:14px;--border:rgba(212,175,55,.25)}
  body{margin:0;background:linear-gradient(160deg,#17120a,#0f0b06);color:#fff7e6;font:15.5px/1.55 system-ui,-apple-system,Segoe UI,Roboto}
  .wrap{max-width:1000px;margin:24px auto;padding:0 16px;display:grid;gap:18px;grid-template-columns:1.1fr 1fr}
  .card{background:#211a0e;border:1px solid var(--border);border-radius:var(--radius);box-shadow:0 18px 36px rgba(0,0,0,.45);padding:16px}
  h1{margin:0 0 8px 0}
  label{display:block;font-size:12px;color:#e8d9b3;margin:6px 0 4px}
  input,textarea{width:100%;padding:10px 12px;border-radius:10px;border:1px solid rgba(212,175,55,.22);background:rgba(23,18,10,.75);color:#fff7e6;outline:none}
  button{appearance:none;border:1px solid rgba(212,175,55,.35);background:linear-gradient(120deg,rgba(212,175,55,.16),rgba(184,138,26,.16));color:#fff7e6;padding:10px 14px;border-radius:12px;font-weight:800;cursor:pointer}
  .items{display:grid;gap:10px}
  .row{display:grid;grid-template-columns:56px 1fr auto;gap:10px;align-items:center;border:1px solid rgba(212,175,55,.18);border-radius:12px;padding:8px}
  .row img{width:56px;height:56px;object-fit:cover;border-radius:10px}
  .sum{display:flex;justify-content:space-between;margin-top:10px}
  @media (max-width:900px){.wrap{grid-template-columns:1fr}}
</style>
</head>
<body>
  <div class="wrap">
    <section class="card">
      <h1>Checkout</h1>
      <form id="orderForm">
        <label>Full name</label><input name="name" required>
        <label>Phone / WhatsApp</label><input name="phone" required>
        <label>City</label><input name="city" required>
        <label>Address</label><input name="address" required>
        <label>Notes (optional)</label><textarea name="notes" rows="4"></textarea>
        <div style="margin-top:12px"><button type="submit">Place order</button></div>
      </form>
    </section>
    <aside class="card">
      <h2>Your items</h2>
      <div id="items" class="items"></div>
      <div class="sum"><span>Subtotal</span><strong id="subtotal">$0</strong></div>
    </aside>
  </div>

<script>
const itemsEl = document.getElementById('items');
const subEl   = document.getElementById('subtotal');
const cart = JSON.parse(localStorage.getItem('hcj-cart')||'[]');

let subtotal = 0;
itemsEl.innerHTML = '';
cart.forEach(it=>{
  subtotal += (it.price||0) * (it.qty||1);
  const row = document.createElement('div');
  row.className = 'row';
  row.innerHTML = `
    <img src="${it.img||'icon/icon-512.png'}" alt="">
    <div><strong>${it.title||it.name||''}</strong><div style="opacity:.75;font-size:.9em">SKU: ${it.sku||'-'} · Qty ${it.qty||1}</div></div>
    <div><strong>${(it.price||0).toLocaleString()} USD</strong></div>`;
  itemsEl.appendChild(row);
});
subEl.textContent = `${Math.round(subtotal).toLocaleString()} USD`;

document.getElementById('orderForm').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const data = Object.fromEntries(new FormData(e.target).entries());
  const payload = {
    ...data,
    items: cart.map(({title,name,sku,qty,price}) => ({
      title: title||name||'',
      sku: sku||'',
      qty: qty||1,
      price: price||0
    })),
    subtotal
  };
  const ENDPOINT = 'YOUR_APPS_SCRIPT_WEB_APP_URL'; // TODO: replace with your Apps Script web app URL
  try{
    const r = await fetch(ENDPOINT, {method:'POST', body: JSON.stringify(payload)});
    if(!r.ok) throw new Error('Network error');
    localStorage.removeItem('hcj-cart');
    alert('Thank you! Order submitted.');
    location.href = 'store.html';
  }catch(err){
    alert('Could not submit the order yet. Please try again.');
  }
});
</script>
</body>
</html>
