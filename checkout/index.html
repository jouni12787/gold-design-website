<!doctype html>
<html lang="en" data-theme="dark">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Checkout — shakaron jewelry</title>
<link rel="icon" href="/icon/icon-1024.png" type="image/png">
<style>
  :root{--radius:14px;--border:rgba(212,175,55,.25)}
  body{margin:0;background:linear-gradient(160deg,#17120a,#0f0b06);color:#fff7e6;font:15.5px/1.55 system-ui,-apple-system,Segoe UI,Roboto}
  .wrap{max-width:1000px;margin:24px auto;padding:0 16px;display:grid;gap:18px;grid-template-columns:1.1fr 1fr}
  .card{background:#211a0e;border:1px solid var(--border);border-radius:var(--radius);box-shadow:0 18px 36px rgba(0,0,0,.45);padding:16px}
  h1{margin:0 0 8px 0}
  label{display:block;font-size:12px;color:#e8d9b3;margin:6px 0 4px}
  input,textarea{width:100%;padding:10px 12px;border-radius:10px;border:1px solid rgba(212,175,55,.22);background:rgba(23,18,10,.75);color:#fff7e6;outline:none}
  button{appearance:none;border:1px solid rgba(212,175,55,.35);background:linear-gradient(120deg,rgba(212,175,55,.16),rgba(184,138,26,.16));color:#fff7e6;padding:10px 14px;border-radius:12px;font-weight:800;cursor:pointer}
  .items{display:grid;gap:10px}
  .row{display:grid;grid-template-columns:56px 1fr auto;gap:10px;align-items:center;border:1px solid rgba(212,175,55,.18);border-radius:12px;padding:8px}
  .row img{width:56px;height:56px;object-fit:cover;border-radius:10px}
  .sum{display:flex;justify-content:space-between;margin-top:10px}
  @media (max-width:900px){.wrap{grid-template-columns:1fr}}
</style>
</head>
<body>
  <div class="wrap">
    <section class="card">
      <h1>Checkout</h1>
      <form id="orderForm">
        <label>Full name</label><input name="name" required>
        <label>Phone / WhatsApp</label><input name="phone" required>
        <label>City</label><input name="city" required>
        <label>Address</label><input name="address" required>
        <label>Notes (optional)</label><textarea name="notes" rows="4"></textarea>
        <div style="margin-top:12px"><button type="submit">Place order</button></div>
      </form>
    </section>
    <aside class="card">
      <h2>Your items</h2>
      <div id="items" class="items"></div>
      <div class="sum"><span>Subtotal</span><strong id="subtotal">$0</strong></div>
      <div class="sum">
        <div><span>Shipping</span><strong id="shipping">$4 USD</strong></div>
        <div><span>Total</span><strong id="grand">$0</strong></div>
      </div>
    </aside>
  </div>

<script>
// read cart (fallback if cart.js is not loaded)
const CART_KEY='hcj-cart';
const SHIPPING=4;
const CURRENCY='USD';
const itemsEl = document.getElementById('items');
const subEl   = document.getElementById('subtotal');
const shipEl  = document.getElementById('shipping');
const grandEl = document.getElementById('grand');
const cart = (window.cartAPI ? cartAPI.load() : JSON.parse(localStorage.getItem(CART_KEY)||'[]'));

let subtotal = 0;
itemsEl.innerHTML = '';
cart.forEach(it=>{
  subtotal += (Number(it.price)||0) * (Number(it.qty)||1);
  const row = document.createElement('div');
  row.className = 'row';
  row.innerHTML = `
    <img src="${it.img||'/icon/icon-512.png'}" alt="">
    <div><strong>${it.title||it.name||''}</strong><div style="opacity:.75;font-size:.9em">SKU: ${it.sku||'-'} · Qty ${it.qty||1}</div></div>
    <div><strong>${(Number(it.price)||0).toLocaleString()} ${CURRENCY}</strong></div>`;
  itemsEl.appendChild(row);
});
subEl.textContent = `${Math.round(subtotal).toLocaleString()} ${CURRENCY}`;
shipEl.textContent = `$${SHIPPING.toFixed(0)} ${CURRENCY}`;
grandEl.textContent = `${Math.round(subtotal+SHIPPING).toLocaleString()} ${CURRENCY}`;

document.getElementById('orderForm').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const data = Object.fromEntries(new FormData(e.target).entries());
  const payload = {
    ...data,
    items: cart.map(({title,name,sku,qty,price}) => ({
      title: title||name||'',
      sku: sku||'',
      qty: Number(qty)||1,
      price: Number(price)||0
    })),
    subtotal: subtotal,
    shipping: SHIPPING,
    total: subtotal + SHIPPING
  };
  const ENDPOINT = 'https://script.google.com/macros/s/AKfycbzfxST_EyN5qnUTvyPvIDAd4TzB5-XnzwnvOZ7Zcr5ZIa6Yi_PbpAmWTBQhmchWRVMp/exec?key=YOUR_SECRET';
  try{
    const r = await fetch(ENDPOINT, {
      method:'POST',
      headers:{ 'Content-Type':'text/plain;charset=utf-8' },
      body: JSON.stringify(payload)
    });
    if(!r.ok) throw new Error('Network error');
    (window.cartAPI ? cartAPI.clear() : localStorage.removeItem(CART_KEY));
    location.href = '/checkout/thanks/';
  }catch(err){
    alert('Could not submit the order yet. Please try again.');
  }
});
</script>
<script src="/scripts/cart.js"></script>
</body>
</html>
