<!doctype html>
<html lang="en" data-theme="light">
<head>
<script>
  // Apply saved theme ASAP (before CSS loads to avoid a flash)
  (function () {
    try {
      var KEY = 'hcj-theme';
      var saved = localStorage.getItem(KEY) || 'light';
      document.documentElement.setAttribute('data-theme', saved);
      // expose the key so other scripts can use the same one
      window.__HCJ_THEME_KEY = KEY;
    } catch (e) {}
  })();
</script>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Chakaroun Jewelry — Store</title>


<!-- PWA + Icons -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#17120a">
<link rel="icon" href="icon/icon-1000.svg" type="image/svg+xml">
<link rel="apple-touch-icon" href="icon/icon-500.png">

<!-- Basic SEO/Open Graph -->
<meta name="description" content="Handcrafted gold jewelry. Live-priced by gold rate soon.">
<meta name="application-name" content="Chakaroun Jewelry">
<meta name="apple-mobile-web-app-title" content="Chakaroun Jewelry">
<meta property="og:title" content="Chakaroun Jewelry — Store">
<meta property="og:description" content="Handcrafted gold jewelry.">
<meta property="og:type" content="website">
<meta property="og:image" content="icon/icon-500.png">
<meta property="og:site_name" content="Chakaroun Jewelry">
<meta name="twitter:title" content="Chakaroun Jewelry — Store">

<style>
  :root{--radius:14px;--shadow:0 18px 36px rgba(0,0,0,.45)}
  /* reuse your themes (copied light/dark/plum vars) */
  html[data-theme="dark"]{
    --bg:#17120a;--bg2:#0f0b06;--card:#211a0e;--card-overlay:rgba(48,37,19,.86);
    --ink:#fff7e6;--muted:#e8d9b3;--gold:#d4af37;--gold2:#b88a1a;
    --border-soft:rgba(212,175,55,.18);--border-strong:rgba(212,175,55,.35);
    --control-border:rgba(212,175,55,.22);--control-bg:rgba(23,18,10,.75);
    --control-focus-bg:rgba(33,26,14,.85);--control-focus-shadow:rgba(212,175,55,.18);
    --head-bg:rgba(15,11,6,.45);--summary-bg:rgba(23,18,10,.85);
    --preview-glow:rgba(212,175,55,.12);--tab-bg:rgba(23,18,10,.75);--tab-active-bg:rgba(33,26,14,.85);
    --hud-bg:rgba(21,15,8,.72);--hud-border:rgba(212,175,55,.2);--hud-text:#fff7e6;
    --button-top:rgba(212,175,55,.16);--button-bottom:rgba(184,138,26,.16);
    --button-hover-top:rgba(212,175,55,.28);--button-hover-bottom:rgba(184,138,26,.2)
  }
  html:not([data-theme]), html[data-theme="light"]{
    --bg:#f6f2ea;--bg2:#e4e9f3;--card:#ffffff;--card-overlay:rgba(255,255,255,.9);
    --ink:#2b261c;--muted:#706b60;--gold:#c8892c;--gold2:#a56a18;
    --border-soft:rgba(200,137,44,.28);--border-strong:rgba(200,137,44,.45);
    --control-border:rgba(200,137,44,.34);--control-bg:rgba(250,244,234,.92);
    --control-focus-bg:rgba(255,250,243,.97);--control-focus-shadow:rgba(200,137,44,.3);
    --head-bg:rgba(242,234,220,.76);--summary-bg:rgba(255,250,243,.92);
    --preview-glow:rgba(200,137,44,.2);--tab-bg:rgba(250,244,234,.88);--tab-active-bg:rgba(255,250,243,.96);
    --hud-bg:rgba(255,250,243,.96);--hud-border:rgba(200,137,44,.38);--hud-text:#2b261c;
    --button-top:rgba(200,137,44,.22);--button-bottom:rgba(165,106,24,.18);
    --button-hover-top:rgba(200,137,44,.32);--button-hover-bottom:rgba(165,106,24,.26)
  }
  html[data-theme="plum"]{
    --bg:#160b19;--bg2:#341844;--card:#2b1433;--card-overlay:rgba(73,35,94,.72);
    --ink:#f8ecff;--muted:#d5c0ec;--gold:#d794ff;--gold2:#b162e4;
    --border-soft:rgba(215,148,255,.32);--border-strong:rgba(215,148,255,.48);
    --control-border:rgba(215,148,255,.36);--control-bg:rgba(41,20,51,.78);
    --control-focus-bg:rgba(55,28,68,.86);--control-focus-shadow:rgba(215,148,255,.26);
    --head-bg:rgba(39,18,50,.65);--summary-bg:rgba(41,20,51,.82);
    --preview-glow:rgba(215,148,255,.18);--tab-bg:rgba(41,20,51,.78);--tab-active-bg:rgba(55,28,68,.88)
  }

  *{box-sizing:border-box}
  body{
    margin:0;color:var(--ink);
    background:
      radial-gradient(1100px 500px at 15% -15%, rgba(0,0,0,0) 0%, transparent 60%),
      radial-gradient(900px 600px at 120% 0%, rgba(0,0,0,0) 0%, transparent 70%),
      linear-gradient(160deg, var(--bg) 0%, var(--bg2) 100%);
    font:15.5px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial
  }

  /* top bar */
  .topbar{
    position:sticky;top:0;z-index:50;
    background:var(--head-bg);backdrop-filter:saturate(1.2) blur(6px);
    border-bottom:1px solid var(--border-soft)
  }
  .topbar .wrap{max-width:1200px;margin:0 auto;padding:10px 16px;display:flex;align-items:center;gap:14px}
  .brand{display:flex;align-items:center;gap:10px;text-decoration:none;color:var(--ink)}
  .brand img{width:36px;height:36px;border-radius:8px}
  .brand .brand-stack{display:flex;flex-direction:column;line-height:1.1}
  .brand .brand-title{font-weight:800;letter-spacing:.4px;font-size:16px}
  .brand .brand-byline{font-weight:600;font-size:11px;opacity:.75}
  .nav{margin-left:auto;display:flex;gap:10px}
  .nav a{color:var(--ink);text-decoration:none;border:1px solid var(--border-soft);padding:8px 12px;border-radius:10px}
  .nav a:hover{border-color:var(--gold)}
  .nav a[aria-current="page"]{border-color:var(--gold);color:var(--gold)}

  /* grid */
  .container{max-width:1200px;margin:22px auto;padding:0 16px}
  .grid{
    display:grid;gap:16px;
    grid-template-columns:repeat( auto-fill, minmax(240px, 1fr) );
  }
  .card{
    background:linear-gradient(160deg,var(--card-overlay),var(--card));
    border:1px solid var(--border-soft);border-radius:14px;overflow:hidden;box-shadow:var(--shadow)
  }
  .thumb{
    position:relative;aspect-ratio:1/1;border-bottom:1px solid var(--border-soft);background:var(--bg2);
    overflow:hidden
  }
  .thumb img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;transition:opacity .35s ease}
  .thumb img.alt{opacity:0}
  .thumb:hover img.alt{opacity:1}
  .thumb:hover img.main{opacity:0}

  .panel{padding:12px 14px}
  .badge{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;border:1px solid var(--border-soft);font-size:12px;color:var(--muted);background:var(--control-bg)}
  .title{margin:0 0 4px;font-size:16px;font-weight:700}
  .meta{font-size:12px;color:var(--muted)}
  .priceBox{
    margin-top:10px;display:flex;align-items:center;justify-content:space-between;gap:8px
  }
  .price{
    font-size:18px;font-weight:800;color:var(--gold)
  }
  .btn{
    appearance:none;border:1px solid var(--border-strong);background:linear-gradient(180deg,var(--button-top),var(--button-bottom));
    padding:8px 12px;border-radius:10px;color:var(--ink);cursor:pointer
  }
  .btn:hover{border-color:var(--gold)}

  /* comments (local only for now) */
  .comments{border-top:1px solid var(--border-soft);margin-top:10px;padding-top:10px}
  .comments h4{margin:0 0 8px;font-size:13px;color:var(--muted)}
  .comments ul{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:8px;max-height:120px;overflow:auto}
  .comments li{font-size:13px;background:var(--control-bg);border:1px solid var(--control-border);padding:6px 8px;border-radius:8px}
  .comments form{display:flex;gap:8px;margin-top:8px}
  .comments input{flex:1;padding:8px 10px;border-radius:8px;border:1px solid var(--control-border);background:var(--control-bg);color:var(--ink)}
  .comments input:focus{outline:none;border-color:var(--gold);box-shadow:0 0 0 2px var(--control-focus-shadow)}

  .head{padding:14px 16px;border-bottom:1px solid var(--border-soft);background:var(--head-bg)}
  .head h1{margin:0;font-size:22px}
  .panel#storeList{min-height:120px}
</style>
</head>
<body>

<header class="topbar">
  <div class="wrap">
    <a class="brand" href="index.html" aria-label="Chakaroun Jewelry — by Hassan Chakaroun &amp; Ali Jouni">
      <img src="icon/icon-500.png" alt="Chakaroun Jewelry logo">
      <span class="brand-stack">
        <span class="brand-title">Chakaroun Jewelry</span>
        <small class="brand-byline">by Hassan Chakaroun &amp; Ali Jouni</small>
      </span>
    </a>
    <nav class="nav">
      <a href="index.html">Bracelet Builder</a>
      <a href="store.html" aria-current="page">Store</a>
    </nav>
  </div>
</header>

<main class="container">
  <section class="card">
    <div class="head"><h1>Store</h1></div>
    <div class="panel" id="storeList">Loading…</div>
  </section>
</main>

<script>
(function () {
  const SHEET_ID = "1zHRWiXCF_SldNShxN_KEEcdhry86JZu61gC3gN6slTk"; // your sheet
  const SHEET_NAME = "Sheet1"; // tab name
  // We’ll use the Google Visualization (gviz) endpoint — no API key required
  const TQ = encodeURIComponent("select A,B,C,D,E,F,G"); // name,price,kirat,photo,description,sku,in_stock
  const URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${encodeURIComponent(SHEET_NAME)}&tqx=out:json&tq=${TQ}`;

  const out = document.getElementById("storeList");

  function driveImage(url) {
    // Accepts "https://drive.google.com/file/d/<id>/view?usp=..." or "...?id=<id>"
    if (!url) return "";
    const m = url.match(/\/d\/([a-zA-Z0-9_-]+)/) || url.match(/[?&]id=([^&]+)/);
    const id = m ? m[1] : null;
    return id ? `https://lh3.googleusercontent.com/d/${id}=w800` : url;
  }

  function money(n) {
    const v = Number(n);
    return Number.isFinite(v) ? v.toLocaleString(undefined, {minimumFractionDigits:0}) : n;
  }

  function render(products) {
    if (!products.length) {
      out.innerHTML = `<div class="badge">No products yet.</div>`;
      return;
    }
    const cards = products.map(p => {
      const img = p.photo ? `<img src="${p.photo}" alt="${p.name}" style="width:120px;height:120px;object-fit:cover;border-radius:10px;border:1px solid var(--border-soft)">` : "";
      const stockBadge = (p.in_stock && Number(p.in_stock) > 0) ? `<span class="badge" style="color:var(--gold)">In stock</span>` : `<span class="badge">Out of stock</span>`;
      return `
        <div style="display:grid;grid-template-columns:140px 1fr;gap:14px;padding:12px 0;border-bottom:1px solid var(--border-soft)">
          <div>${img}</div>
          <div>
            <div style="display:flex;gap:10px;align-items:center;justify-content:space-between;">
              <h3 style="margin:0">${p.name || ""}</h3>
              <div><strong>${money(p.price)}</strong> <span style="color:var(--muted)">USD</span></div>
            </div>
            <div style="color:var(--muted);margin:6px 0">${p.description || ""}</div>
            <div style="display:flex;gap:12px;font-size:12px;color:var(--muted)">
              <span>Kirat: ${p.kirat || "-"}</span>
              <span>SKU: ${p.sku || "-"}</span>
              ${stockBadge}
            </div>
          </div>
        </div>
      `;
    }).join("");
    out.innerHTML = cards;
  }

  fetch(URL)
    .then(r => r.text())
    .then(txt => {
      // gviz returns: "/*O_o*/ google.visualization.Query.setResponse({...});"
      const json = JSON.parse(txt.substring(47, txt.length - 2));
      const rows = (json.table?.rows || []);
      const products = rows.map(r => {
        const [name, price, kirat, photo, description, sku, in_stock] = r.c.map(c => c ? c.v : "");
        return {
          name, price, kirat, photo: driveImage(photo), description, sku, in_stock
        };
      });
      render(products);
    })
    .catch(err => {
      console.error(err);
      out.innerHTML = `<div class="badge">Could not load products.</div>`;
    });
})();
</script>
</body>
</html>
